<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Felixent AMS â€” Dashboard</title>

  <!-- Dynamic base: uses deployed path on Vercel, or relative './' for local dev -->
  <script>
    (function() {
      const deployedBase = "https://demoprojects-xi.vercel.app/AMS/";
      const hostMatch = location.hostname === 'demoprojects-xi.vercel.app';
      const baseHref = hostMatch ? deployedBase : './';
      const existing = document.querySelector('base');
      if (existing) existing.setAttribute('href', baseHref);
      else {
        const b = document.createElement('base');
        b.setAttribute('href', baseHref);
        document.head.insertBefore(b, document.head.firstChild);
      }
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <style>
    .sidebar-transition { transition: width .18s ease; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    @media print { aside, .no-print { display: none !important; } main { margin: 0; width: 100%; } }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen antialiased">

  <!-- sidebar inject -->
  <div id="sidebar-root"></div>

  <main id="main" class="ml-0 lg:ml-64 p-6">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold">Felixent Asset Management System</h1>
        <p class="text-sm text-gray-600">Dashboard â€” overview, charts, recent movements</p>
      </div>

      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2">
          <button onclick="setLanguage('en')" class="p-2 rounded hover:bg-gray-200" title="English">ğŸ‡¬ğŸ‡§</button>
          <button onclick="setLanguage('mm')" class="p-2 rounded hover:bg-gray-200" title="á€™á€¼á€”á€ºá€™á€¬">ğŸ‡²ğŸ‡²</button>
        </div>

        <button id="toggleOrderBtn" onclick="toggleSheetOrder()" class="text-sm text-gray-600 hover:underline no-print">ğŸŒ Myanmar-first</button>

        <div class="flex items-center gap-2 no-print">
          <button onclick="exportCSV()" class="bg-indigo-600 text-white px-3 py-2 rounded">ğŸ“ CSV</button>
          <button onclick="exportExcel()" class="bg-yellow-600 text-white px-3 py-2 rounded">ğŸ“Š Excel</button>
          <button onclick="exportMultiSheetExcel()" class="bg-teal-600 text-white px-3 py-2 rounded">ğŸ“Š Multi-Sheet</button>
          <button onclick="window.print()" class="bg-green-600 text-white px-3 py-2 rounded">ğŸ–¨ï¸ Print</button>
        </div>
      </div>
    </header>

    <section id="view-dashboard" class="view">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
        <div class="bg-white rounded shadow p-4">
          <h3 class="text-sm font-semibold mb-2">Totals</h3>
          <div class="grid grid-cols-3 gap-4 text-center">
            <div><div class="text-lg font-bold" id="totalAssets">0</div><div class="text-xs text-gray-500">Assets</div></div>
            <div><div class="text-lg font-bold" id="totalSuppliers">0</div><div class="text-xs text-gray-500">Suppliers</div></div>
            <div><div class="text-lg font-bold" id="totalMovements">0</div><div class="text-xs text-gray-500">Movements</div></div>
          </div>
        </div>

        <div class="bg-white rounded shadow p-4 lg:col-span-2">
          <h3 class="text-sm font-semibold mb-2">Quick Filters</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="filterAssets('All')" class="px-3 py-2 bg-gray-200 rounded">All</button>
            <button onclick="filterAssets('New')" class="px-3 py-2 bg-yellow-100 rounded">New</button>
            <button onclick="filterAssets('In Use')" class="px-3 py-2 bg-green-100 rounded">In Use</button>
            <button onclick="filterAssets('Maintenance')" class="px-3 py-2 bg-orange-100 rounded">Maintenance</button>
            <button onclick="filterAssets('Reassigned')" class="px-3 py-2 bg-blue-100 rounded">Reassigned</button>
            <button onclick="filterAssets('Retired')" class="px-3 py-2 bg-gray-100 rounded">Retired</button>
            <input id="dashSearch" type="search" placeholder="Search ID, name, category" class="ml-auto border rounded px-3 py-2" />
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div class="bg-white rounded shadow p-4">
          <h3 class="text-sm font-semibold mb-2">Assets by Category</h3>
          <canvas id="categoryChart" class="w-full h-64"></canvas>
        </div>

        <div class="bg-white rounded shadow p-4">
          <h3 class="text-sm font-semibold mb-2">Assets by Status</h3>
          <canvas id="statusChart" class="w-full h-64"></canvas>
        </div>

        <div class="bg-white rounded shadow p-4 lg:col-span-2">
          <h3 class="text-sm font-semibold mb-2">Recent Movements</h3>
          <div id="recentMovements" class="text-sm text-gray-700 max-h-48 overflow-auto"></div>
        </div>

        <div class="bg-white rounded shadow p-4 lg:col-span-2">
          <h3 class="text-sm font-semibold mb-2">Items Snapshot</h3>
          <div class="overflow-x-auto">
            <table class="w-full table-auto">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left">ID</th>
                  <th class="px-4 py-2 text-left">Name</th>
                  <th class="px-4 py-2 text-left">Category</th>
                  <th class="px-4 py-2 text-left">Location</th>
                  <th class="px-4 py-2 text-left">Status</th>
                  <th class="px-4 py-2 text-left">Assigned</th>
                  <th class="px-4 py-2 text-left">Action</th>
                </tr>
              </thead>
              <tbody id="assetTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section id="view-settings" class="view hidden">
      <h2 class="text-lg font-bold">Settings</h2>
      <div class="bg-white rounded shadow p-4 mt-3">Settings placeholder</div>
    </section>

    <!-- Edit modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
      <div class="bg-white p-6 rounded shadow w-full max-w-md">
        <h2 class="text-xl font-bold mb-3" id="editModalTitle">âœï¸ Edit Asset</h2>
        <form id="editForm" class="grid gap-3">
          <input id="edit_id" type="text" disabled class="border p-2 rounded bg-gray-100" />
          <input id="edit_name" type="text" placeholder="Name" class="border p-2 rounded" />
          <input id="edit_category" type="text" placeholder="Category" class="border p-2 rounded" />
          <input id="edit_location" type="text" placeholder="Location" class="border p-2 rounded" />
          <select id="edit_status" class="border p-2 rounded">
            <option>New</option><option>In Use</option><option>Maintenance</option><option>Reassigned</option><option>Retired</option>
          </select>
          <input id="edit_assignedTo" type="text" placeholder="Assigned To" class="border p-2 rounded" />
          <div class="flex justify-between mt-2">
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded" id="editSaveBtn">Save</button>
            <button type="button" onclick="closeEditModal()" class="text-gray-600 hover:underline" id="editCancelBtn">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- shared scripts -->
  <script src="js/sidebar.js"></script>
  <script src="js/data.js"></script>
  <script src="js/movementData.js"></script>
  <script src="js/suppliers.js"></script>
  <script src="js/render.js"></script>
  <script src="js/page-hooks.js"></script>
  <script src="js/data-simulator.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dashSearch = document.getElementById('dashSearch');
      if (dashSearch) {
        dashSearch.addEventListener('input', () => {
          const q = dashSearch.value.trim().toLowerCase();
          const filtered = (window.assetData || []).filter(a => `${a.id} ${a.name} ${a.category}`.toLowerCase().includes(q));
          const tbody = document.getElementById('assetTableBody');
          tbody.innerHTML = filtered.slice(0, 30).map(a => `
            <tr class="border-b">
              <td class="px-4 py-2">${a.id}</td>
              <td class="px-4 py-2">${a.name}</td>
              <td class="px-4 py-2">${a.category}</td>
              <td class="px-4 py-2">${a.location}</td>
              <td class="px-4 py-2 font-semibold">${a.status}</td>
              <td class="px-4 py-2">${a.assignedTo || '-'}</td>
              <td class="px-4 py-2"><button class="text-blue-600" onclick="openEditModal(${(window.assetData||[]).findIndex(x=>x.id===a.id)})">Edit</button></td>
            </tr>
          `).join('');
        });
      }
      if (typeof window.refreshDashboard === 'function') window.refreshDashboard();
    });
  </script>
</body>
</html>
