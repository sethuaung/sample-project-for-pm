<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Methodology Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Warm Sand & Deep Teal -->
    <style>
        /* Base Styles */
        .sidebar-btn {
            @apply w-full text-left px-4 py-3 rounded-lg text-stone-700 font-medium hover:bg-teal-100 hover:text-teal-800 transition-all duration-150;
        }
        .sidebar-btn-active {
            @apply bg-teal-600 text-white shadow-md hover:bg-teal-600 hover:text-white;
        }
        .info-card {
            @apply bg-white p-6 rounded-xl shadow-sm border border-stone-200;
        }

        /* --- MODERN PROCESS FLOW STYLES --- */
        .process-step {
            @apply flex-shrink-0 w-36 sm:w-40 text-center;
        }
        .process-step-inner {
            /* Modern style: Bright top border, strong shadow, and interactive hover effect */
            @apply p-4 bg-white rounded-xl shadow-lg h-full flex flex-col justify-center transition-all duration-300 transform hover:scale-[1.03] border-t-4 border-teal-500;
        }
        .process-arrow {
            /* Clean vertical divider with an internal icon for emphasis */
            @apply flex-shrink-0 flex items-center justify-center w-10 text-2xl text-teal-600;
        }
        .process-step-title {
            @apply font-bold text-base text-teal-800 mb-1;
        }
        .process-step-desc {
            @apply text-xs text-stone-600;
        }
        /* --------------------------------- */

        /* --- MODERN LIST CARD STYLES (Used for Roles, Artifacts, Principles, BestFor) --- */
        .list-card-container {
            /* Flex layout for two columns on desktop, single column on mobile */
            @apply grid gap-3 grid-cols-1 md:grid-cols-2;
        }
        .list-card-item {
            /* Card style for individual items */
            @apply bg-stone-50 p-4 rounded-xl border border-stone-200 shadow-sm transition-all duration-150 hover:shadow-md hover:border-teal-400;
        }
        .list-card-title {
            @apply font-semibold text-base text-teal-700;
        }
        .list-card-desc {
            @apply text-sm text-stone-600 mt-0.5;
        }
        .list-card-simple {
            /* Style for items without a colon separator (like Principles) */
            @apply text-sm text-stone-700 font-medium;
        }
        /* --------------------------------------- */

        /* Styles for new input fields in modal */
        .form-input, .form-textarea {
            @apply w-full p-2 border border-stone-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500;
        }
        .form-textarea {
            min-height: 80px;
        }
        /* Custom print style: Hide sidebar and FAB when printing */
        @media print {
            aside, #fab-generate {
                display: none !important;
            }
            main {
                margin: 0 !important;
                padding: 1rem !important;
            }
            body {
                background-color: white;
            }
            .info-card {
                box-shadow: none;
                border: 1px solid #eee;
            }
            .process-step-inner {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                border-top: 4px solid #0d9488 !important; /* Retain color for print */
                transform: none !important; /* Disable scale on print */
            }
            .process-arrow {
                color: #0d9488 !important; /* Tailwind teal-600 */
            }
            .list-card-item {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                background-color: #f9f9f9 !important;
            }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans antialiased">

    <div class="flex flex-col md:flex-row min-h-screen">

        <aside class="w-full md:w-64 bg-white p-4 md:border-r border-b md:border-b-0 border-stone-200 flex-shrink-0">
            <h1 class="text-2xl font-bold text-teal-700 mb-6 px-2">PM Dashboard</h1>
            <nav class="flex flex-row md:flex-col gap-2">
                <button id="btn-scrum" class="sidebar-btn" onclick="showMethodology('scrum')">Scrum</button>
                <button id="btn-kanban" class="sidebar-btn" onclick="showMethodology('kanban')">Kanban</button>
                <button id="btn-waterfall" class="sidebar-btn" onclick="showMethodology('waterfall')">Waterfall</button>
                <button id="btn-prince2" class="sidebar-btn" onclick="showMethodology('prince2')">PRINCE2</button>
            </nav>
        </aside>

        <main class="flex-1 p-6 md:p-10">
            <header class="mb-8">
                <h2 id="info-title" class="text-3xl font-bold text-stone-900 mb-2"></h2>
                <p id="info-description" class="text-lg text-stone-600"></p>
            </header>

            <div class="space-y-6">
                <!-- Process Flow Section -->
                <div class="info-card col-span-1 lg:col-span-2">
                    <h3 class="font-semibold text-xl text-teal-700 mb-4">Typical Process Flow</h3>
                    <p class="text-sm text-stone-600 mb-4">This section outlines the typical, high-level process for the selected methodology. Interact by scrolling horizontally if needed on smaller screens.</p>
                    <div id="info-process-flow" class="flex overflow-x-auto p-2 -mx-2">
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- At a Glance Section (Principles) -->
                    <div class="info-card">
                        <h3 class="font-semibold text-xl text-teal-700 mb-4">At a Glance (Principles)</h3>
                        <div id="info-at-a-glance" class="list-card-container">
                        </div>
                    </div>

                    <!-- Best For Section -->
                    <div class="info-card">
                        <h3 class="font-semibold text-xl text-teal-700 mb-4">Best For...</h3>
                        <div id="info-best-for" class="list-card-container">
                        </div>
                    </div>

                    <!-- Key Roles Section -->
                    <div class="info-card">
                        <h3 class="font-semibold text-xl text-teal-700 mb-4">Key Roles</h3>
                        <div id="info-roles" class="list-card-container">
                        </div>
                    </div>

                    <!-- Key Artifacts Section -->
                    <div class="info-card">
                        <h3 class="font-semibold text-xl text-teal-700 mb-4">Key Artifacts</h3>
                        <div id="info-artifacts" class="list-card-container">
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <button id="fab-generate" class="fixed bottom-6 right-6 bg-teal-600 text-white p-4 rounded-full shadow-xl hover:bg-teal-700 transition-all duration-150" title="Generate Template">
            <span class="w-6 h-6 block">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625a3.375 3.375 0 0 0-3.375 3.375v11.25a3.375 3.375 0 0 0 3.375 3.375h12.75a3.375 3.375 0 0 0 3.375-3.375V11.25a3.375 3.375 0 0 0-3.375-3.375H10.5m-4.125 0h.008v.008H6.375v-.008Z" />
                </svg>
            </span>
        </button>

        <div id="template-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="fixed inset-0 bg-black/50" onclick="document.getElementById('modal-close-btn').click()"></div>
            <div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl z-10 flex flex-col" style="max-height: 90vh;">
                <div class="flex justify-between items-center p-6 border-b border-stone-200">
                    <h2 class="text-2xl font-bold text-teal-700">Generate Template</h2>
                    <button id="modal-close-btn" class="text-stone-500 hover:text-stone-800">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto">
                    <!-- Dynamic form content will be injected here -->
                    <div id="modal-form-content" class="p-6 space-y-4">
                    </div>

                    <!-- Live preview area -->
                    <div class="p-6 bg-stone-50 border-t border-stone-200">
                        <h3 class="text-lg font-semibold text-teal-700 mb-2">Live Preview</h3>
                        <pre id="modal-pre-content" class="bg-stone-900 text-stone-100 p-4 rounded-lg text-sm whitespace-pre-wrap">Your template will appear here...</pre>
                    </div>
                </div>

                <div class="p-4 bg-stone-50 border-t border-stone-200 flex justify-between items-center">
                    <span id="modal-copy-message" class="text-green-600 text-sm"></span>
                    <div class="flex space-x-3">
                        <button id="btn-modal-print" class="bg-stone-200 text-stone-700 font-semibold py-2 px-4 rounded-lg hover:bg-stone-300 transition duration-150 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 8v3a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V8M6 8a2 2 0 1 0-4 0v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 1 0-4 0M6 8V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2" />
                            </svg>
                            Print
                        </button>
                        <button id="btn-modal-export" class="bg-stone-200 text-stone-700 font-semibold py-2 px-4 rounded-lg hover:bg-stone-300 transition duration-150 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                            </svg>
                            Export
                        </button>
                        <button id="modal-copy-btn" class="bg-teal-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-teal-700 transition duration-150">
                            Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const methodologyData = {
            'scrum': {
                name: 'Scrum (Agile)',
                description: 'A lightweight framework within Agile that helps teams manage complex projects using short, time-boxed iterations called "Sprints".',
                process: [
                    { name: 'Product Backlog', desc: 'Prioritized list of features' },
                    { name: 'Sprint Planning', desc: 'Team selects work' },
                    { name: 'Sprint Backlog', desc: 'Work for the sprint' },
                    { name: 'Sprint (2-4 wks)', desc: 'Daily Scrums' },
                    { name: 'Increment', desc: 'Shippable product' },
                    { name: 'Sprint Review', desc: 'Demo work' },
                    { name: 'Retrospective', desc: 'Team improves' }
                ],
                principles: ['Iterative development', 'Empirical process control (transparency, inspection, adaptation)', 'Time-boxing', 'Customer collaboration', 'Embraces change'],
                bestFor: ['Complex projects with unclear or evolving requirements', 'Software development', 'R&D and new product development', 'Startups and fast-moving teams'],
                roles: ['Product Owner: Manages the Product Backlog, represents stakeholders.', 'Scrum Master: Facilitates the process, removes impediments, coaches the team.', 'Development Team: Cross-functional, self-organizing group that builds the product.'],
                artifacts: ['Product Backlog: The single source of requirements for any changes to be made.', 'Sprint Backlog: The set of Product Backlog items selected for the Sprint.', 'Increment: The sum of all Product Backlog items completed during a Sprint.'],
                fields: [
                    { id: 'projectName', label: 'Project Name', type: 'input', placeholder: 'My Awesome Project' },
                    { id: 'productOwner', label: 'Product Owner', type: 'input', placeholder: 'Jane Doe' },
                    { id: 'scrumMaster', label: 'Scrum Master', type: 'input', placeholder: 'John Smith' },
                    { id: 'devTeam', label: 'Development Team', type: 'input', placeholder: 'Alice, Bob, Carol' },
                    { id: 'sprintGoal', label: 'Sprint 1 Goal', type: 'input', placeholder: 'Initial user login' },
                    { id: 'backlogItems', label: 'Product Backlog (User Stories)', type: 'textarea', placeholder: 'As a user, I want to log in, so that I can access my profile.' }
                ],
                template: (data) => `
### Scrum Project Template ###

---
**PROJECT:** ${data.projectName || '[Project Name]'}
**PRODUCT OWNER:** ${data.productOwner || '[Name]'}
**SCRUM MASTER:** ${data.scrumMaster || '[Name]'}
**DEVELOPMENT TEAM:** ${data.devTeam || '[Names]'}
---

**1. PRODUCT BACKLOG (High-Level User Stories)**
${data.backlogItems || '* (As a [user], I want [feature], so that [benefit])'}

**2. SPRINT 1: ${data.sprintGoal || '[Sprint Goal]'}**

**Sprint 1 Backlog (Tasks)**
* [User Story 1]: Task 1, Task 2
* [User Story 2]: Task 1, Task 2
* ...

**3. CEREMONIES SCHEDULE**
* **Sprint Planning:** [Date, Time]
* **Daily Scrums:** [Time, Daily]
* **Sprint Review:** [Date, Time]
* **Sprint Retrospective:** [Date, Time]
`
            },
            'kanban': {
                name: 'Kanban (Agile)',
                description: 'A visual method for managing workflow. It focuses on continuous delivery, limiting work-in-progress (WIP), and visualizing tasks on a "Kanban board".',
                process: [
                    { name: 'Backlog', desc: 'All potential tasks' },
                    { name: 'To Do', desc: 'Prioritized tasks' },
                    { name: 'In Progress (WIP)', desc: 'Tasks being worked on' },
                    { name: 'In Review', desc: 'Awaiting verification' },
                    { name: 'Done', desc: 'Completed tasks' }
                ],
                principles: ['Visualize the workflow', 'Limit Work-in-Progress (WIP)', 'Manage flow', 'Make policies explicit', 'Implement feedback loops'],
                bestFor: ['Projects with variable workflow', 'Support and maintenance teams', 'Continuous delivery environments', 'Visualizing work in any context'],
                roles: ['No formally prescribed roles. The team is collectively responsible.', 'A "Service Delivery Manager" or "Flow Master" may exist to facilitate.'],
                artifacts: ['Kanban Board: The visual representation of the workflow.', 'Kanban Cards: Represent individual work items, move across the board.', 'WIP Limits: Explicit rules on the max number of items in a stage.'],
                fields: [
                    { id: 'teamName', label: 'Team/Project Name', type: 'input', placeholder: 'Support Team' },
                    { id: 'primaryGoal', label: 'Primary Goal', type: 'input', placeholder: 'Continuous delivery of features' },
                    { id: 'wipInProgress', label: 'WIP Limit (In Progress)', type: 'input', placeholder: '3' },
                    { id: 'wipInReview', label: 'WIP Limit (In Review)', type: 'input', placeholder: '2' },
                    { id: 'backlogItems', label: 'Backlog Items (Examples)', type: 'textarea', placeholder: 'Fix login bug\nAdd new report' }
                ],
                template: (data) => `
### Kanban Board Template ###

---
**PROJECT/TEAM:** ${data.teamName || '[Project/Team Name]'}
**PRIMARY GOAL:** ${data.primaryGoal || '[e.g., Continuous delivery of features]'}
---

**KANBAN BOARD COLUMNS:**

1.  **BACKLOG**
    * (All ideas and future tasks)
${data.backlogItems ? data.backlogItems.split('\n').map(item => `    * ${item}`).join('\n') : '    * [Example Item 1]'}

2.  **TO DO / READY**
    * (Tasks prioritized and ready to be started)
    * ...

3.  **IN PROGRESS (WIP Limit: ${data.wipInProgress || '[Number]'})**
    * (Tasks actively being worked on)
    * ...

4.  **IN REVIEW / TESTING (WIP Limit: ${data.wipInReview || '[Number]'})**
    * (Tasks completed and awaiting verification)
    * ...

5.  **DONE**
    * (Completed, verified, and delivered tasks)
    * ...
`
            },
            'waterfall': {
                name: 'Waterfall',
                description: 'A traditional, linear methodology. Each phase must be fully completed and signed off before the next phase can begin. It requires clear, fixed requirements upfront.',
                process: [
                    { name: 'Requirements', desc: 'Gather and document all needs' },
                    { name: 'Design', desc: 'Create system and software design' },
                    { name: 'Implementation', desc: 'Build the system' },
                    { name: 'Testing', desc: 'Verify and validate' },
                    { name: 'Deployment', desc: 'Release to users' },
                    { name: 'Maintenance', desc: 'Ongoing support' }
                ],
                principles: ['Sequential process', 'Fixed requirements and scope', 'Heavy documentation', 'Formal phase-gate reviews and sign-offs', 'Change is costly and avoided'],
                bestFor: ['Projects with fixed, clear requirements and a stable scope', 'Construction or manufacturing projects', 'Projects where compliance and documentation are paramount', 'Simple, well-understood problems'],
                roles: ['Project Manager: Responsible for planning, execution, and control.', 'Business Analyst: Gathers and documents requirements.', 'Architect/Engineer: Creates the technical design.', 'Development Team: Builds the product.', 'QA Team: Tests the product against requirements.'],
                artifacts: ['Requirements Document (BRD/SRD): The "bible" of the project.', 'Design Documents: Detailed technical specs.', 'Gantt Chart: The master project schedule.', 'Test Plans & Cases: Formal documents for verification.'],
                fields: [
                    { id: 'projectName', label: 'Project Name', type: 'input', placeholder: 'ERP System Implementation' },
                    { id: 'projectManager', label: 'Project Manager', type: 'input', placeholder: 'Alex Chen' },
                    { id: 'stakeholder', label: 'Key Stakeholder (Sign-off)', type: 'input', placeholder: 'Finance Director' },
                    { id: 'requirements', label: 'Key Requirements (Summary)', type: 'textarea', placeholder: '1. Module for invoicing\n2. Module for payroll' },
                    { id: 'design', label: 'Design Deliverables', type: 'textarea', placeholder: 'System Design Document\nTechnical Specifications' }
                ],
                template: (data) => `
### Waterfall Project Plan Template ###

---
**PROJECT:** ${data.projectName || '[Project Name]'}
**PROJECT MANAGER:** ${data.projectManager || '[Name]'}
**DATE:** ${new Date().toLocaleDateString()}
---

**1. REQUIREMENTS PHASE**
* **Objective:** Define and document all project requirements.
* **Key Deliverables:**
${data.requirements ? data.requirements.split('\n').map(item => `    * ${item}`).join('\n') : '    * Requirements Document\n    * Project Scope Statement'}
* **Sign-off:** ${data.stakeholder || '[Stakeholder Name]'}

**2. DESIGN PHASE**
* **Objective:** Create the technical and system design based on requirements.
* **Key Deliverables:**
${data.design ? data.design.split('\n').map(item => `    * ${item}`).join('\n') : '    * System Design Document\n    * Technical Specifications'}
* **Sign-off:** ${data.stakeholder || '[Stakeholder Name]'}

**3. IMPLEMENTATION (BUILD) PHASE**
* **Objective:** Code and build the software/product.
* **Key Deliverables:**
    * Working Software Modules
    * Unit Test Results
* **Sign-off:** [Lead Developer]

**4. TESTING (VERIFICATION) PHASE**
* **Objective:** Find and fix bugs; ensure product meets requirements.
* **Key Deliverables:**
    * Test Plans & Test Cases
    * Bug Reports
    * User Acceptance Testing (UAT) Sign-off
* **Sign-off:** [QA Lead / Stakeholder]

**5. DEPLOYMENT PHASE**
* **Objective:** Release the product to users.
* **Key Deliverables:**
    * Live Product
    * User Manuals & Training
* **Sign-off:** ${data.projectManager || '[Project Manager]'}

**6. MAINTENANCE PHASE**
* **Objective:** Provide ongoing support and updates.
`
            },
            'prince2': {
                name: 'PRINCE2',
                description: 'PRINCE2 (PRojects IN Controlled Environments) is a structured, process-based method. It focuses on business justification, defined roles, and management by stages.',
                process: [
                    { name: 'Starting Up', desc: 'Appoint team, create brief' },
                    { name: 'Initiating', desc: 'Create Project Initiation Doc (PID)' },
                    { name: 'Controlling a Stage', desc: 'PM manages daily work' },
                    { name: 'Managing Product Delivery', desc: 'Team builds products' },
                    { name: 'Managing Stage Boundary', desc: 'Plan next stage' },
                    { name: 'Closing', desc: 'Formal project sign-off' }
                ],
                principles: ['Continued business justification', 'Learn from experience', 'Defined roles and responsibilities', 'Manage by stages', 'Manage by exception', 'Focus on products'],
                bestFor: ['Large, formal, or enterprise-level projects', 'Government or public sector projects', 'Projects requiring significant oversight, control, and documentation', 'Managing projects within a corporate program'],
                roles: ['Project Board: The ultimate authority (Executive, Senior User, Senior Supplier).', 'Project Manager: Manages the project on a day-to-day basis.', 'Team Manager: Leads a team to create specific products.', 'Project Assurance: Checks that the project is being conducted correctly.'],
                artifacts: ['Business Case: The "why" (cost, benefit, risk). Updated at each stage.', 'Project Initiation Document (PID): The master plan for the project.', 'Stage Plans: Detailed plans for each management stage.', 'Work Packages: Sets of work assigned to a Team Manager.'],
                fields: [
                    { id: 'projectName', label: 'Project Name', type: 'input', placeholder: 'New Office Relocation' },
                    { id: 'projectManager', label: 'Project Manager', type: 'input', placeholder: 'David Lee' },
                    { id: 'executive', label: 'Executive (Project Board)', type: 'input', placeholder: 'Sarah Chen' },
                    { id: 'seniorUser', label: 'Senior User (Project Board)', type: 'input', placeholder: 'Michael Brown (COO)' },
                    { id: 'seniorSupplier', label: 'Senior Supplier (Project Board)', type: 'input', placeholder: 'IT Director' },
                    { id: 'businessCase', label: 'Business Case (Summary)', type: 'textarea', placeholder: 'Reduce overhead by 20% by consolidating offices...' },
                    { id: 'mainDeliverable', label: 'Project Product Description', type: 'input', placeholder: 'A fully operational new office space.' }
                ],
                template: (data) => `
### PRINCE2 Project Brief Template ###

---
**PROJECT:** ${data.projectName || '[Project Name]'}
**PROJECT MANAGER:** ${data.projectManager || '[Name]'}
**EXECUTIVE:** ${data.executive || '[Name]'}
---

**1. PROJECT DEFINITION**
* **Background:** (Why is this project needed?)
* **Project Objectives:** (What will the project achieve? Must be measurable.)
* **Business Case:**
    ${data.businessCase || '(The "why" - costs, benefits, and justification.)'}

**2. PROJECT TEAM STRUCTURE (Key Roles)**
* **Project Board:**
    * Executive: ${data.executive || '[Name]'} (Accountable for success)
    * Senior User: ${data.seniorUser || '[Name]'} (Represents user needs)
    * Senior Supplier: ${data.seniorSupplier || '[Name]'} (Represents supplier interests)
* **Project Manager:** ${data.projectManager || '[Name]'} (Manages day-to-day)
* **Project Assurance:** (Roles for checking quality, user, supplier)

**3. SCOPE & PRODUCT DESCRIPTION**
* **Project Scope (In/Out):** (What is/is not included?)
* **Project Product Description:**
    ${data.mainDeliverable || '(What is the final, main deliverable?)'}
* **Key Deliverables:** (Major products to be created)

**4. INITIAL STAGE PLAN (Stage 1)**
* (High-level plan for the first stage after initiation)

**5. KEY RISKS (Initial)**
* (Top 3-5 risks identified so far)
`
            }
        };

        // Fill in truncated data for display
        ['scrum', 'kanban', 'waterfall', 'prince2'].forEach(id => {
            const data = methodologyData[id];
            if (!data.principles) data.principles = ['N/A'];
            if (!data.bestFor) data.bestFor = ['N/A'];
            if (!data.roles) data.roles = ['N/A'];
            if (!data.artifacts) data.artifacts = ['N/A'];
            if (!data.process) data.process = [{ name: 'N/A', desc: 'N/A' }];
        });


        const state = {
            activeMethodology: 'scrum'
        };

        const ui = {
            title: document.getElementById('info-title'),
            description: document.getElementById('info-description'),
            processFlow: document.getElementById('info-process-flow'),
            atAGlance: document.getElementById('info-at-a-glance'),
            bestFor: document.getElementById('info-best-for'),
            roles: document.getElementById('info-roles'), // Div container
            artifacts: document.getElementById('info-artifacts'), // Div container
            modal: document.getElementById('template-modal'),
            modalForm: document.getElementById('modal-form-content'),
            modalPre: document.getElementById('modal-pre-content'),
            modalCopyBtn: document.getElementById('modal-copy-btn'),
            modalCloseBtn: document.getElementById('modal-close-btn'),
            modalCopyMsg: document.getElementById('modal-copy-message'),
            fab: document.getElementById('fab-generate'),
            modalPrintBtn: document.getElementById('btn-modal-print'),
            modalExportBtn: document.getElementById('btn-modal-export')
        };

        // Helper function to render card items (Roles/Artifacts - Title/Description)
        function renderRoleArtifactItems(container, items) {
            container.innerHTML = items.map(item => {
                // Split at the first ': ' to separate title and description
                const parts = item.split(': ');
                const name = parts[0] + (parts.length > 1 ? ':' : '');
                const description = parts.length > 1 ? parts.slice(1).join(': ') : item;

                return `
                    <div class="list-card-item">
                        <h4 class="list-card-title">${name}</h4>
                        <p class="list-card-desc">${description}</p>
                    </div>
                `;
            }).join('');
        }

        // Helper function to render simple card items (Principles/Best For - Single line)
        function renderSimpleCardItems(container, items) {
            container.innerHTML = items.map(item => {
                return `
                    <div class="list-card-item flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-teal-500 mr-2 flex-shrink-0">
                            <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.052-.143Z" clip-rule="evenodd" />
                        </svg>
                        <p class="list-card-simple">${item}</p>
                    </div>
                `;
            }).join('');
        }


        function showMethodology(id) {
            if (!methodologyData[id]) return;

            state.activeMethodology = id;
            const data = methodologyData[id];

            ui.title.textContent = data.name;
            ui.description.textContent = data.description;

            // Render Process Flow (Modern Style)
            ui.processFlow.innerHTML = data.process.map((step, index) => {
                return `
                    <div class="process-step">
                        <div class="process-step-inner">
                            <h4 class="process-step-title">${step.name}</h4>
                            <p class="process-step-desc">${step.desc}</p>
                        </div>
                    </div>
                ` + (index < data.process.length - 1 ?
                    `<div class="process-arrow">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3" />
                        </svg>
                    </div>` : '');
            }).join('');

            // Render Principles and Best For (New Card Style)
            renderSimpleCardItems(ui.atAGlance, data.principles);
            renderSimpleCardItems(ui.bestFor, data.bestFor);

            // Render Roles and Artifacts (New Card Style)
            renderRoleArtifactItems(ui.roles, data.roles);
            renderRoleArtifactItems(ui.artifacts, data.artifacts);

            document.querySelectorAll('.sidebar-btn').forEach(btn => {
                btn.classList.remove('sidebar-btn-active');
            });
            document.getElementById(`btn-${id}`).classList.add('sidebar-btn-active');
        }

        function updateTemplatePreview() {
            const data = methodologyData[state.activeMethodology];
            if (!data) return;

            const formData = {};
            data.fields.forEach(field => {
                const element = document.getElementById(`form-field-${field.id}`);
                if (element) {
                    formData[field.id] = element.value;
                }
            });

            const templateString = data.template(formData);
            ui.modalPre.innerText = templateString.trim();
        }

        function openTemplateModal() {
            const data = methodologyData[state.activeMethodology];
            if (!data) return;

            ui.modalForm.innerHTML = ''; // Clear old form

            data.fields.forEach(field => {
                const fieldId = `form-field-${field.id}`;
                const label = `<label for="${fieldId}" class="block text-sm font-medium text-stone-700">${field.label}</label>`;
                let input = '';

                if (field.type === 'textarea') {
                    input = `<textarea id="${fieldId}" class="form-textarea" placeholder="${field.placeholder || ''}"></textarea>`;
                } else {
                    input = `<input type="text" id="${fieldId}" class="form-input" placeholder="${field.placeholder || ''}">`;
                }

                ui.modalForm.innerHTML += `<div class="mb-4">${label}${input}</div>`;
            });

            // Add event listeners
            data.fields.forEach(field => {
                const fieldId = `form-field-${field.id}`;
                document.getElementById(fieldId).addEventListener('keyup', updateTemplatePreview);
            });

            updateTemplatePreview(); // Run once to populate initial preview
            ui.modal.classList.remove('hidden');
            ui.modalCopyMsg.textContent = '';
        }

        function handleModalPrint() {
            const printContent = ui.modalPre.innerText;
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print Template</title>');
            printWindow.document.write('<style>body{font-family: monospace; white-space: pre-wrap; margin: 20px; line-height: 1.5;}</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write('<pre>' + printContent + '</pre>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();

            printWindow.onload = function() {
                printWindow.print();
                printWindow.close();
            };
        }

        function handleModalExport() {
            const activeMethodology = methodologyData[state.activeMethodology].name.replace(/[^a-z0-9]/gi, '_').toLowerCase();
            const filename = `${activeMethodology}_template.txt`;
            const content = ui.modalPre.innerText;

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        ui.fab.addEventListener('click', openTemplateModal);

        ui.modalCloseBtn.addEventListener('click', () => {
            ui.modal.classList.add('hidden');
        });

        ui.modalPrintBtn.addEventListener('click', handleModalPrint);
        ui.modalExportBtn.addEventListener('click', handleModalExport);

        ui.modalCopyBtn.addEventListener('click', () => {
            const textToCopy = ui.modalPre.innerText;

            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = textToCopy;
            tempTextarea.style.position = 'absolute';
            tempTextarea.style.left = '-9999px';

            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            tempTextarea.setSelectionRange(0, 99999);

            try {
                document.execCommand('copy');
                ui.modalCopyMsg.textContent = 'Copied to clipboard!';
            } catch (err) {
                ui.modalCopyMsg.textContent = 'Failed to copy.';
            }

            document.body.removeChild(tempTextarea);

            setTimeout(() => {
                ui.modalCopyMsg.textContent = '';
            }, 2000);
        });

        document.addEventListener('DOMContentLoaded', () => {
            showMethodology('scrum');
        });
    </script>
</body>
</html>
